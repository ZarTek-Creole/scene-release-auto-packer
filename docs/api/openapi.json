{
  "openapi": "3.0.3",
  "info": {
    "title": "eBook Scene Packer v2 API",
    "description": "API REST compl\u00e8te pour eBook Scene Packer v2 permettant la cr\u00e9ation, gestion et packaging de releases Scene (EBOOK, TV, DOCS, etc.) avec syst\u00e8me de permissions granulaires, gestion des rules, utilisateurs, r\u00f4les et configurations.\n\n**Authentification** : Tous les endpoints (sauf `/auth/login`) requi\u00e8rent un JWT Bearer Token dans le header `Authorization`.\n\n**Permissions** : Les endpoints v\u00e9rifient les permissions READ/WRITE/MOD/DELETE selon la ressource et l'action.\n",
    "version": "1.0.0",
    "contact": {
      "name": "Dev Team",
      "email": "dev@example.com"
    },
    "license": {
      "name": "Proprietary"
    }
  },
  "servers": [
    {
      "url": "http://localhost:5000/api",
      "description": "D\u00e9veloppement local"
    },
    {
      "url": "https://api.example.com/api",
      "description": "Production (exemple)"
    }
  ],
  "tags": [
    {
      "name": "Authentication",
      "description": "Authentification et gestion des tokens JWT"
    },
    {
      "name": "Dashboard",
      "description": "Statistiques et informations dashboard"
    },
    {
      "name": "Wizard",
      "description": "Wizard 9 \u00e9tapes pour cr\u00e9ation release"
    },
    {
      "name": "Releases",
      "description": "Gestion des releases cr\u00e9\u00e9es"
    },
    {
      "name": "Rules",
      "description": "Gestion des rules Scene (locales et scenerules.org)"
    },
    {
      "name": "Users",
      "description": "Gestion des utilisateurs (admin uniquement)"
    },
    {
      "name": "Roles",
      "description": "Gestion des r\u00f4les et permissions (admin uniquement)"
    },
    {
      "name": "Configurations",
      "description": "Configuration syst\u00e8me, APIs, destinations FTP/SSH (admin uniquement)"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT Access Token obtenu via `/auth/login`.\n\n**Format** : `Authorization: Bearer <access_token>`\n\n**Dur\u00e9e de vie** : 15 minutes\n\n**Refresh** : Utiliser `/auth/refresh` avec refresh_token\n"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "required": [
          "error",
          "message"
        ],
        "properties": {
          "error": {
            "type": "string",
            "example": "ValidationError"
          },
          "message": {
            "type": "string",
            "example": "Invalid input"
          },
          "errors": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "example": {
              "username": [
                "Username is required"
              ]
            }
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "example": 1
          },
          "per_page": {
            "type": "integer",
            "example": 20
          },
          "total": {
            "type": "integer",
            "example": 150
          },
          "pages": {
            "type": "integer",
            "example": 8
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "username": {
            "type": "string",
            "example": "operator"
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "operator@example.com"
          },
          "note": {
            "type": "string",
            "nullable": true,
            "example": "Operator account"
          },
          "active": {
            "type": "boolean",
            "example": true
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "Operator"
            ]
          },
          "groups": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "TESTGROUP"
            ]
          },
          "permissions": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "example": {
              "releases": [
                "READ",
                "WRITE"
              ],
              "rules": [
                "READ",
                "WRITE"
              ]
            }
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-01T10:00:00Z"
          }
        }
      },
      "Release": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "group": {
            "type": "string",
            "example": "TESTGROUP"
          },
          "type": {
            "type": "string",
            "enum": [
              "EBOOK",
              "TV",
              "DOCS",
              "AUDIOBOOK",
              "GAME"
            ],
            "example": "EBOOK"
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "completed",
              "failed"
            ],
            "example": "completed"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true,
            "example": {
              "title": "Example Book",
              "author": "John Doe",
              "isbn": "1234567890"
            }
          },
          "config": {
            "type": "object",
            "additionalProperties": true,
            "example": {
              "format": "ZIP",
              "volumes": 50
            }
          },
          "file_path": {
            "type": "string",
            "nullable": true,
            "example": "/releases/testgroup-example-book.epub"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-01T10:00:00Z"
          },
          "user": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer"
              },
              "username": {
                "type": "string"
              }
            }
          }
        }
      },
      "Job": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 124
          },
          "release_id": {
            "type": "integer",
            "nullable": true,
            "example": 1
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "running",
              "completed",
              "failed"
            ],
            "example": "completed"
          },
          "config_json": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true
          },
          "logs": {
            "type": "string",
            "nullable": true,
            "example": "Packaging started...\nFile analyzed..."
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-01T10:00:00Z"
          },
          "created_by": {
            "type": "integer",
            "example": 1
          }
        }
      },
      "Rule": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "name": {
            "type": "string",
            "example": "eBOOK-2024"
          },
          "content": {
            "type": "string",
            "example": "Title: {{title}}\nAuthor: {{author}}\n..."
          },
          "scene": {
            "type": "string",
            "nullable": true,
            "example": "English"
          },
          "section": {
            "type": "string",
            "nullable": true,
            "example": "eBOOK"
          },
          "year": {
            "type": "integer",
            "nullable": true,
            "example": 2024
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-01T10:00:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        }
      },
      "Role": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "name": {
            "type": "string",
            "example": "Admin"
          },
          "description": {
            "type": "string",
            "nullable": true,
            "example": "Administrateur avec acc\u00e8s complet"
          },
          "permissions": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "example": {
              "releases": [
                "READ",
                "WRITE",
                "MOD",
                "DELETE"
              ]
            }
          },
          "users_count": {
            "type": "integer",
            "example": 2
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    }
  },
  "paths": {
    "/auth/login": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "security": [],
        "summary": "Connexion utilisateur",
        "description": "Authentification et obtention tokens JWT (access + refresh)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "username",
                  "password"
                ],
                "properties": {
                  "username": {
                    "type": "string",
                    "example": "operator"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "example": "securepassword123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connexion r\u00e9ussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {
                      "type": "string",
                      "example": "eyJ0eXAiOiJKV1QiLCJhbGc..."
                    },
                    "refresh_token": {
                      "type": "string",
                      "example": "eyJ0eXAiOiJKV1QiLCJhbGc..."
                    },
                    "user": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Credentials invalides",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Unauthorized",
                  "message": "Invalid username or password"
                }
              }
            }
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "Rafra\u00eechir access token",
        "description": "Obtenir un nouveau access token avec refresh token",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Token rafra\u00eechi",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "access_token": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Refresh token invalide/expir\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "Authentication"
        ],
        "summary": "D\u00e9connexion",
        "description": "Invalidation refresh token",
        "responses": {
          "200": {
            "description": "D\u00e9connexion r\u00e9ussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Logout successful"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "Authentication"
        ],
        "summary": "Informations utilisateur connect\u00e9",
        "description": "R\u00e9cup\u00e9rer informations utilisateur depuis token JWT",
        "responses": {
          "200": {
            "description": "Informations utilisateur",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          }
        }
      }
    },
    "/dashboard/stats": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "Statistiques dashboard",
        "description": "Statistiques globales et par utilisateur",
        "responses": {
          "200": {
            "description": "Statistiques",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "releases_count": {
                      "type": "integer",
                      "example": 150
                    },
                    "my_releases_count": {
                      "type": "integer",
                      "example": 25
                    },
                    "releases_by_type": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "integer"
                      },
                      "example": {
                        "EBOOK": 100,
                        "TV": 40,
                        "DOCS": 10
                      }
                    },
                    "recent_releases": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Release"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/{step}/validate": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Valider \u00e9tape wizard",
        "description": "Valider donn\u00e9es \u00e9tape wizard (1-9)",
        "parameters": [
          {
            "name": "step",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 9
            },
            "example": 1
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "Donn\u00e9es d\u00e9pendantes de l'\u00e9tape",
                "example": {
                  "group": "TESTGROUP"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validation r\u00e9sultat",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean"
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/{step}/save": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Sauvegarder progression \u00e9tape",
        "description": "Sauvegarder progression \u00e9tape dans backend (Job draft)",
        "parameters": [
          {
            "name": "step",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 9
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "data": {
                    "type": "object",
                    "additionalProperties": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Progression sauvegard\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/{step}/data": {
      "get": {
        "tags": [
          "Wizard"
        ],
        "summary": "R\u00e9cup\u00e9rer donn\u00e9es \u00e9tape",
        "description": "R\u00e9cup\u00e9rer donn\u00e9es \u00e9tape sauvegard\u00e9e",
        "parameters": [
          {
            "name": "step",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "job_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Donn\u00e9es \u00e9tape",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "step": {
                      "type": "integer"
                    },
                    "data": {
                      "type": "object",
                      "additionalProperties": true
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/pack": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Lancer packaging",
        "description": "Lancer packaging release (\u00e9tape 8)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "job_id"
                ],
                "properties": {
                  "job_id": {
                    "type": "integer"
                  },
                  "options": {
                    "type": "object",
                    "properties": {
                      "format": {
                        "type": "string",
                        "enum": [
                          "ZIP",
                          "RAR",
                          "BOTH"
                        ]
                      },
                      "compression": {
                        "type": "string"
                      },
                      "volumes": {
                        "type": "integer"
                      },
                      "generate_nfo": {
                        "type": "boolean"
                      },
                      "generate_diz": {
                        "type": "boolean"
                      },
                      "generate_sfv": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Packaging d\u00e9marr\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/jobs/{job_id}/status": {
      "get": {
        "tags": [
          "Wizard"
        ],
        "summary": "Statut job packaging",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Statut job",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Job"
                }
              }
            }
          }
        }
      }
    },
    "/wizard/jobs/{job_id}/logs": {
      "get": {
        "tags": [
          "Wizard"
        ],
        "summary": "Logs job temps r\u00e9el",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "since",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Logs job",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "logs": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "level": {
                            "type": "string"
                          },
                          "message": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/jobs/{job_id}/analysis": {
      "get": {
        "tags": [
          "Wizard"
        ],
        "summary": "R\u00e9sultats analyse fichier",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "R\u00e9sultats analyse",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "metadata": {
                      "type": "object",
                      "additionalProperties": true
                    },
                    "mediainfo": {
                      "type": "object",
                      "additionalProperties": true
                    },
                    "structure": {
                      "type": "object",
                      "additionalProperties": true
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/5/analyze": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Lancer analyse fichier",
        "description": "Lancer analyse asynchrone fichier (\u00e9tape 5)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "file_path",
                  "release_type"
                ],
                "properties": {
                  "file_path": {
                    "type": "string"
                  },
                  "release_type": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Analyse d\u00e9marr\u00e9e (asynchrone)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/6/enrich": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Enrichir m\u00e9tadonn\u00e9es",
        "description": "Enrichir m\u00e9tadonn\u00e9es avec APIs externes (\u00e9tape 6)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "metadata": {
                    "type": "object"
                  },
                  "release_type": {
                    "type": "string"
                  },
                  "api_priority": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "M\u00e9tadonn\u00e9es enrichies",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "enriched": {
                      "type": "object"
                    },
                    "sources": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/wizard/step/7/render": {
      "post": {
        "tags": [
          "Wizard"
        ],
        "summary": "Rendu pr\u00e9visualisation template",
        "description": "G\u00e9n\u00e9rer pr\u00e9visualisation NFO depuis template (\u00e9tape 7)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "template_id": {
                    "type": "integer"
                  },
                  "metadata": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Pr\u00e9visualisation g\u00e9n\u00e9r\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "preview": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases": {
      "get": {
        "tags": [
          "Releases"
        ],
        "summary": "Liste releases",
        "description": "Liste releases avec filtres, recherche et pagination",
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "EBOOK",
                  "TV",
                  "DOCS",
                  "AUDIOBOOK",
                  "GAME"
                ]
              }
            }
          },
          {
            "name": "group",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "draft",
                  "completed",
                  "failed"
                ]
              }
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 100
            }
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "created_at",
                "name",
                "size"
              ],
              "default": "created_at"
            }
          },
          {
            "name": "order",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            }
          },
          {
            "name": "my_only",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste releases",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "releases": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Release"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}": {
      "get": {
        "tags": [
          "Releases"
        ],
        "summary": "D\u00e9tail release",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "D\u00e9tail release",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Release"
                }
              }
            }
          },
          "404": {
            "description": "Release non trouv\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Releases"
        ],
        "summary": "\u00c9dition release",
        "description": "Modifier release (permission WRITE requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "metadata": {
                    "type": "object"
                  },
                  "config": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Release modifi\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Permission WRITE manquante",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Releases"
        ],
        "summary": "Suppression release",
        "description": "Supprimer release (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Release supprim\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/repack": {
      "post": {
        "tags": [
          "Releases"
        ],
        "summary": "Repackaging release",
        "description": "Repackager release (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "options": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Repackaging d\u00e9marr\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/nfofix": {
      "post": {
        "tags": [
          "Releases"
        ],
        "summary": "Correction NFO",
        "description": "Corriger fichier NFO release (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "NFO corrig\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "changes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/readnfo": {
      "post": {
        "tags": [
          "Releases"
        ],
        "summary": "R\u00e9g\u00e9n\u00e9ration depuis NFO",
        "description": "R\u00e9g\u00e9n\u00e9rer release depuis NFO existant (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "R\u00e9g\u00e9n\u00e9ration d\u00e9marr\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/dirfix": {
      "post": {
        "tags": [
          "Releases"
        ],
        "summary": "Correction structure r\u00e9pertoires",
        "description": "Corriger structure r\u00e9pertoires release (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Structure corrig\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "changes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/files": {
      "get": {
        "tags": [
          "Releases"
        ],
        "summary": "Arborescence fichiers",
        "description": "Liste fichiers release",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Arborescence fichiers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "files": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "path": {
                            "type": "string"
                          },
                          "size": {
                            "type": "integer"
                          },
                          "type": {
                            "type": "string",
                            "enum": [
                              "file",
                              "directory"
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/releases/{id}/jobs": {
      "get": {
        "tags": [
          "Releases"
        ],
        "summary": "Historique jobs",
        "description": "Liste jobs associ\u00e9s \u00e0 release",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Historique jobs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "jobs": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Job"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules": {
      "get": {
        "tags": [
          "Rules"
        ],
        "summary": "Liste rules locales",
        "description": "Liste rules locales avec filtres et recherche",
        "parameters": [
          {
            "name": "scene",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "section",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "year",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "type",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste rules",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "rules": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Rule"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/local": {
      "get": {
        "tags": [
          "Rules"
        ],
        "summary": "Liste rules locales uniquement",
        "description": "Identique \u00e0 /rules mais explicite",
        "parameters": [
          {
            "name": "scene",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "section",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "year",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste rules locales",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "rules": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Rule"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/scenerules": {
      "get": {
        "tags": [
          "Rules"
        ],
        "summary": "Liste rules scenerules.org",
        "description": "Liste rules disponibles sur scenerules.org",
        "parameters": [
          {
            "name": "scene",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "section",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "year",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "type",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste rules scenerules.org",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "rules": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "scene": {
                            "type": "string"
                          },
                          "section": {
                            "type": "string"
                          },
                          "year": {
                            "type": "integer"
                          },
                          "url": {
                            "type": "string",
                            "format": "uri"
                          },
                          "downloaded": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/{id}": {
      "put": {
        "tags": [
          "Rules"
        ],
        "summary": "\u00c9dition rule locale",
        "description": "Modifier rule locale (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "content": {
                    "type": "string"
                  },
                  "scene": {
                    "type": "string"
                  },
                  "section": {
                    "type": "string"
                  },
                  "year": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rule modifi\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Rules"
        ],
        "summary": "Suppression rule locale",
        "description": "Supprimer rule locale (permission MOD requise)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Rule supprim\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/{id}/preview": {
      "get": {
        "tags": [
          "Rules"
        ],
        "summary": "Pr\u00e9visualisation rule",
        "description": "Contenu rule format\u00e9 pour NFO viewer",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Pr\u00e9visualisation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "content": {
                      "type": "string"
                    },
                    "formatted": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/upload": {
      "post": {
        "tags": [
          "Rules"
        ],
        "summary": "Upload rule locale",
        "description": "Upload rule depuis fichier local (permission WRITE requise)",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  },
                  "name": {
                    "type": "string"
                  },
                  "scene": {
                    "type": "string"
                  },
                  "section": {
                    "type": "string"
                  },
                  "year": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rule upload\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/download": {
      "post": {
        "tags": [
          "Rules"
        ],
        "summary": "T\u00e9l\u00e9chargement rule scenerules.org",
        "description": "T\u00e9l\u00e9charger rule depuis scenerules.org vers rules locales (permission WRITE requise)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "scene": {
                    "type": "string"
                  },
                  "section": {
                    "type": "string"
                  },
                  "year": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rule t\u00e9l\u00e9charg\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/rules/sync": {
      "post": {
        "tags": [
          "Rules"
        ],
        "summary": "Synchronisation scenerules.org",
        "description": "Synchroniser rules depuis scenerules.org (admin uniquement, asynchrone)",
        "responses": {
          "202": {
            "description": "Synchronisation d\u00e9marr\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Liste utilisateurs",
        "description": "Liste utilisateurs (admin uniquement)",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "active",
                  "inactive"
                ]
              }
            }
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "group",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste utilisateurs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/Pagination"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Cr\u00e9ation utilisateur",
        "description": "Cr\u00e9er nouvel utilisateur (admin uniquement)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "username",
                  "password"
                ],
                "properties": {
                  "username": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 100
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "minLength": 8
                  },
                  "note": {
                    "type": "string"
                  },
                  "active": {
                    "type": "boolean",
                    "default": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Utilisateur cr\u00e9\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "username": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation \u00e9chou\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "409": {
            "description": "Username dupliqu\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "D\u00e9tail utilisateur",
        "description": "D\u00e9tail utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "D\u00e9tail utilisateur",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Modification utilisateur",
        "description": "Modifier utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "note": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "active": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Utilisateur modifi\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Users"
        ],
        "summary": "Suppression utilisateur",
        "description": "Supprimer/d\u00e9sactiver utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "permanent",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Utilisateur supprim\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/groups": {
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Affectation groupes",
        "description": "Affecter groupes \u00e0 utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "group_ids"
                ],
                "properties": {
                  "group_ids": {
                    "type": "array",
                    "items": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Groupes affect\u00e9s",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "groups": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/groups/{group_id}": {
      "delete": {
        "tags": [
          "Users"
        ],
        "summary": "Retrait groupe",
        "description": "Retirer groupe de utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "group_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Groupe retir\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/roles": {
      "post": {
        "tags": [
          "Users"
        ],
        "summary": "Affectation r\u00f4le",
        "description": "Affecter r\u00f4le \u00e0 utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "role_id"
                ],
                "properties": {
                  "role_id": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "R\u00f4le affect\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "role": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/permissions": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "R\u00e9cup\u00e9ration permissions",
        "description": "R\u00e9cup\u00e9rer permissions utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Permissions utilisateur",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "role_permissions": {
                      "type": "object"
                    },
                    "custom_permissions": {
                      "type": "object"
                    },
                    "final_permissions": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Users"
        ],
        "summary": "Configuration permissions",
        "description": "Configurer permissions personnalis\u00e9es utilisateur (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "permissions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "resource": {
                          "type": "string"
                        },
                        "action": {
                          "type": "string",
                          "enum": [
                            "READ",
                            "WRITE",
                            "MOD",
                            "DELETE"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Permissions mises \u00e0 jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/roles": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "Liste r\u00f4les",
        "description": "Liste tous les r\u00f4les",
        "responses": {
          "200": {
            "description": "Liste r\u00f4les",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "roles": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Role"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Roles"
        ],
        "summary": "Cr\u00e9ation r\u00f4le",
        "description": "Cr\u00e9er nouveau r\u00f4le (admin uniquement)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 100
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "R\u00f4le cr\u00e9\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/roles/{id}": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "D\u00e9tail r\u00f4le",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "D\u00e9tail r\u00f4le",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Role"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Modification r\u00f4le",
        "description": "Modifier r\u00f4le (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "R\u00f4le modifi\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Roles"
        ],
        "summary": "Suppression r\u00f4le",
        "description": "Supprimer r\u00f4le (admin uniquement, avec v\u00e9rification utilisateurs)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "reassign_to",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "R\u00f4le supprim\u00e9",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "users_reassigned": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "R\u00f4le utilis\u00e9 sans r\u00e9assignation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/roles/{id}/permissions": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "R\u00e9cup\u00e9ration permissions r\u00f4le",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Permissions r\u00f4le",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "permissions": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Roles"
        ],
        "summary": "Configuration permissions r\u00f4le",
        "description": "Configurer permissions r\u00f4le (admin uniquement)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "permissions": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "enum": [
                          "READ",
                          "WRITE",
                          "MOD",
                          "DELETE"
                        ]
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Permissions mises \u00e0 jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    },
                    "users_affected": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/roles/{id}/users": {
      "get": {
        "tags": [
          "Roles"
        ],
        "summary": "Liste utilisateurs par r\u00f4le",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste utilisateurs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/system": {
      "get": {
        "tags": [
          "Configurations"
        ],
        "summary": "Param\u00e8tres syst\u00e8me",
        "description": "R\u00e9cup\u00e9rer param\u00e8tres syst\u00e8me (admin uniquement)",
        "responses": {
          "200": {
            "description": "Param\u00e8tres syst\u00e8me",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "paths": {
                      "type": "object",
                      "properties": {
                        "uploads": {
                          "type": "string"
                        },
                        "releases": {
                          "type": "string"
                        },
                        "cache": {
                          "type": "string"
                        },
                        "logs": {
                          "type": "string"
                        }
                      }
                    },
                    "limits": {
                      "type": "object",
                      "properties": {
                        "max_file_size": {
                          "type": "integer"
                        },
                        "api_timeout": {
                          "type": "integer"
                        },
                        "ftp_timeout": {
                          "type": "integer"
                        }
                      }
                    },
                    "logs": {
                      "type": "object",
                      "properties": {
                        "level": {
                          "type": "string"
                        },
                        "rotation_size": {
                          "type": "integer"
                        },
                        "rotation_count": {
                          "type": "integer"
                        },
                        "format": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Configurations"
        ],
        "summary": "Mise \u00e0 jour param\u00e8tres syst\u00e8me",
        "description": "Modifier param\u00e8tres syst\u00e8me (admin uniquement)",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "paths": {
                    "type": "object"
                  },
                  "limits": {
                    "type": "object"
                  },
                  "logs": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Param\u00e8tres mis \u00e0 jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/apis": {
      "get": {
        "tags": [
          "Configurations"
        ],
        "summary": "Liste configurations APIs",
        "description": "Liste configurations APIs externes (admin uniquement)",
        "parameters": [
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste configurations APIs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "apis": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "name": {
                            "type": "string"
                          },
                          "active": {
                            "type": "boolean"
                          },
                          "user_id": {
                            "type": "integer",
                            "nullable": true
                          },
                          "configured": {
                            "type": "boolean"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Configurations"
        ],
        "summary": "Cr\u00e9ation configuration API",
        "description": "Cr\u00e9er configuration API (admin uniquement, cl\u00e9 chiffr\u00e9e)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "api_key"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "api_key": {
                    "type": "string"
                  },
                  "active": {
                    "type": "boolean",
                    "default": true
                  },
                  "user_id": {
                    "type": "integer",
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Configuration API cr\u00e9\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/apis/{id}": {
      "put": {
        "tags": [
          "Configurations"
        ],
        "summary": "Modification configuration API",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "api_key": {
                    "type": "string"
                  },
                  "active": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Configuration API modifi\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Configurations"
        ],
        "summary": "Suppression configuration API",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Configuration API supprim\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/apis/{id}/test": {
      "post": {
        "tags": [
          "Configurations"
        ],
        "summary": "Test connexion API",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "query": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "R\u00e9sultat test connexion",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "response_time": {
                      "type": "integer",
                      "nullable": true
                    },
                    "error": {
                      "type": "string",
                      "nullable": true
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/destinations": {
      "get": {
        "tags": [
          "Configurations"
        ],
        "summary": "Liste destinations FTP/SSH",
        "description": "Liste destinations FTP/SSH (admin uniquement)",
        "parameters": [
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Liste destinations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "destinations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "name": {
                            "type": "string"
                          },
                          "host": {
                            "type": "string"
                          },
                          "port": {
                            "type": "integer"
                          },
                          "user": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string",
                            "enum": [
                              "FTP",
                              "SFTP",
                              "SSH"
                            ]
                          },
                          "user_id": {
                            "type": "integer",
                            "nullable": true
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Configurations"
        ],
        "summary": "Cr\u00e9ation destination FTP/SSH",
        "description": "Cr\u00e9er destination (admin uniquement, password chiffr\u00e9)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "host",
                  "user",
                  "password",
                  "type"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "host": {
                    "type": "string"
                  },
                  "port": {
                    "type": "integer",
                    "default": 21
                  },
                  "user": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "FTP",
                      "SFTP",
                      "SSH"
                    ]
                  },
                  "options": {
                    "type": "object"
                  },
                  "user_id": {
                    "type": "integer",
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Destination cr\u00e9\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/destinations/{id}": {
      "put": {
        "tags": [
          "Configurations"
        ],
        "summary": "Modification destination",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "host": {
                    "type": "string"
                  },
                  "port": {
                    "type": "integer"
                  },
                  "user": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "options": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Destination modifi\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Configurations"
        ],
        "summary": "Suppression destination",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Destination supprim\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/destinations/{id}/test": {
      "post": {
        "tags": [
          "Configurations"
        ],
        "summary": "Test connexion FTP/SSH",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "R\u00e9sultat test connexion",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "response_time": {
                      "type": "integer",
                      "nullable": true
                    },
                    "error": {
                      "type": "string",
                      "nullable": true
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/templates": {
      "get": {
        "tags": [
          "Configurations"
        ],
        "summary": "Configuration stockage templates",
        "description": "R\u00e9cup\u00e9rer configuration stockage templates (admin uniquement)",
        "responses": {
          "200": {
            "description": "Configuration templates",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "storage": {
                      "type": "string",
                      "enum": [
                        "db",
                        "disk"
                      ]
                    },
                    "disk_path": {
                      "type": "string",
                      "nullable": true
                    },
                    "templates_count": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Configurations"
        ],
        "summary": "Mise \u00e0 jour configuration templates",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "storage": {
                    "type": "string",
                    "enum": [
                      "db",
                      "disk"
                    ]
                  },
                  "disk_path": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Configuration mise \u00e0 jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/templates/migrate": {
      "post": {
        "tags": [
          "Configurations"
        ],
        "summary": "Migration templates",
        "description": "Migrer templates disque \u2194 DB (admin uniquement, asynchrone)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "from",
                  "to"
                ],
                "properties": {
                  "from": {
                    "type": "string",
                    "enum": [
                      "db",
                      "disk"
                    ]
                  },
                  "to": {
                    "type": "string",
                    "enum": [
                      "db",
                      "disk"
                    ]
                  },
                  "disk_path": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Migration d\u00e9marr\u00e9e",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "job_id": {
                      "type": "integer"
                    },
                    "status": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/config/preferences": {
      "get": {
        "tags": [
          "Configurations"
        ],
        "summary": "Pr\u00e9f\u00e9rences utilisateur",
        "description": "R\u00e9cup\u00e9rer pr\u00e9f\u00e9rences utilisateur connect\u00e9",
        "parameters": [
          {
            "name": "key",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Pr\u00e9f\u00e9rences utilisateur",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "preferences": {
                      "type": "object",
                      "additionalProperties": true
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Configurations"
        ],
        "summary": "Mise \u00e0 jour pr\u00e9f\u00e9rences",
        "description": "Mettre \u00e0 jour pr\u00e9f\u00e9rences utilisateur",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Pr\u00e9f\u00e9rences mises \u00e0 jour",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}