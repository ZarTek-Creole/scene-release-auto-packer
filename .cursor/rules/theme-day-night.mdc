---
name: theme-day-night
description: R√®gles strictes pour Th√®me Jour/Nuit - Variables CSS, Transition, Persistance
globs:
  - "**/*.{ts,tsx,js,jsx,css,scss}"
---

# Th√®me Jour/Nuit - eBook Scene Packer v2

## üéØ Principe Fondamental

**Th√®me jour/nuit avec transition fluide et persistance** : Tous les composants DOIVENT supporter le th√®me jour/nuit via variables CSS, avec transition fluide et pr√©f√©rence sauvegard√©e.

---

## üö® R√àGLES ABSOLUES

### 1. Variables CSS Obligatoires
- ‚úÖ **TOUJOURS** utiliser variables CSS pour couleurs (jamais hardcod√©es)
- ‚úÖ **TOUJOURS** d√©finir variables pour th√®me jour ET nuit
- ‚úÖ **TOUJOURS** utiliser `data-theme` attribute pour switch

### 2. Transition Fluide
- ‚úÖ **Transition** : 250ms pour toutes propri√©t√©s (background-color, color, border-color)
- ‚úÖ **Transition globale** : Appliqu√©e via `*` selector ou variables CSS
- ‚úÖ **Pas de flash** : Transition douce, pas de changement brutal

### 3. Persistance
- ‚úÖ **localStorage** : Sauvegarder pr√©f√©rence utilisateur
- ‚úÖ **Restoration** : Restaurer th√®me au chargement page
- ‚úÖ **Default** : Th√®me jour par d√©faut (si aucune pr√©f√©rence)

---

## üé® Variables CSS Th√®me

### Structure Variables

```css
:root {
  /* Th√®me Clair (Jour) */
  --color-primary: #0d6efd;
  --color-bg: #ffffff;
  --color-text: #212529;
  --text-secondary: #6c757d;
  --border-color: #e9ecef;
  --bg-secondary: #f8f9fa;
  --bg-tertiary: #e9ecef;
}

[data-theme="dark"] {
  /* Th√®me Sombre (Nuit) */
  --color-primary: #4dabf7;
  --color-bg: #1a1d20;
  --color-text: #f8f9fa;
  --text-secondary: #adb5bd;
  --border-color: #495057;
  --bg-secondary: #212529;
  --bg-tertiary: #2b2f33;
}
```

### Toutes Propri√©t√©s Adaptatives

**Obligatoire** : Toutes couleurs DOIVENT utiliser variables CSS :
- `background-color` : `var(--color-bg)`
- `color` : `var(--color-text)`
- `border-color` : `var(--border-color)`
- Couleurs primaires : `var(--color-primary)`

---

## üîÑ Impl√©mentation React

### ThemeContext

```tsx
// ‚úÖ Bon : ThemeContext selon Design System
import React, { createContext, useContext, useState, useEffect } from 'react';

type Theme = 'light' | 'dark';

interface ThemeContextType {
  theme: Theme;
  setTheme: (theme: Theme) => void;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [theme, setThemeState] = useState<Theme>(() => {
    // Restaurer depuis localStorage
    const saved = localStorage.getItem('theme');
    return (saved as Theme) || 'light';
  });

  useEffect(() => {
    // Appliquer th√®me au document
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);

  const setTheme = (newTheme: Theme) => {
    setThemeState(newTheme);
  };

  const toggleTheme = () => {
    setThemeState((prev) => (prev === 'light' ? 'dark' : 'light'));
  };

  return (
    <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
};

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider');
  }
  return context;
};
```

### ThemeToggle Component

```tsx
// ‚úÖ Bon : Toggle selon Design System
import { useTheme } from '../contexts/ThemeContext';
import { Sun, Moon } from 'bootstrap-icons-react';
import { Button } from './ui/Button';

export const ThemeToggle: React.FC = () => {
  const { theme, toggleTheme } = useTheme();

  return (
    <Button
      variant="ghost"
      size="md"
      onClick={toggleTheme}
      aria-label={theme === 'light' ? 'Activer th√®me sombre' : 'Activer th√®me clair'}
    >
      {theme === 'light' ? (
        <Moon className="icon-md" aria-hidden="true" />
      ) : (
        <Sun className="icon-md" aria-hidden="true" />
      )}
      <span className="sr-only">
        {theme === 'light' ? 'Th√®me sombre' : 'Th√®me clair'}
      </span>
    </Button>
  );
};
```

---

## üé® Transition Fluide

### CSS Global

```css
/* ‚úÖ Obligatoire : Transition pour toutes propri√©t√©s */
* {
  transition: background-color var(--transition-normal),
              color var(--transition-normal),
              border-color var(--transition-normal);
}

/* Variables transitions */
:root {
  --transition-fast: 150ms ease-in-out;
  --transition-normal: 250ms ease-in-out;
  --transition-slow: 350ms ease-in-out;
}
```

**Note** : Transition appliqu√©e globalement pour √©viter flash lors changement th√®me.

---

## ‚úÖ Checklist Impl√©mentation

### Variables CSS
- [ ] Variables th√®me jour d√©finies (`:root`)
- [ ] Variables th√®me nuit d√©finies (`[data-theme="dark"]`)
- [ ] Toutes couleurs utilisent variables CSS
- [ ] Pas de couleurs hardcod√©es

### React Context
- [ ] `ThemeContext` cr√©√©
- [ ] `ThemeProvider` impl√©ment√©
- [ ] `useTheme` hook cr√©√©
- [ ] Persistance localStorage fonctionnelle

### Composant Toggle
- [ ] `ThemeToggle` cr√©√© avec ic√¥nes Bootstrap Icons
- [ ] Bouton variant="ghost" selon Design System
- [ ] ARIA labels pr√©sents
- [ ] Transition fluide visible

### Tests
- [ ] Test toggle th√®me
- [ ] Test persistance localStorage
- [ ] Test restoration au chargement
- [ ] Test contraste couleurs (WCAG 2.2 AA)

---

## üö´ Anti-Patterns

### ‚ùå Couleurs Hardcod√©es
```css
/* ‚ùå Mauvais */
.button {
  background-color: #0d6efd;  /* Hardcod√© */
  color: #ffffff;
}

/* ‚úÖ Bon */
.button {
  background-color: var(--color-primary);
  color: var(--text-inverse);
}
```

### ‚ùå Pas de Transition
```css
/* ‚ùå Mauvais : Pas de transition */
[data-theme="dark"] {
  --color-bg: #1a1d20;
}

/* ‚úÖ Bon : Transition globale */
* {
  transition: background-color var(--transition-normal);
}
```

### ‚ùå Pas de Persistance
```tsx
// ‚ùå Mauvais : Pas de localStorage
const [theme, setTheme] = useState<'light' | 'dark'>('light');

// ‚úÖ Bon : Persistance localStorage
const [theme, setTheme] = useState<Theme>(() => {
  const saved = localStorage.getItem('theme');
  return (saved as Theme) || 'light';
});
```

---

## üìö R√©f√©rences

- **Design System** : `docs/DESIGN_SYSTEM_UI_UX.md` (section Th√®me Jour/Nuit)
- **R√®gle Design System** : `.cursor/rules/design-system-ui-ux.mdc`
- **PRD-001** : `docs/PRDs/PRD-001-Interface-Admin.md` (US-004)

---

**Derni√®re mise √† jour** : 2025-11-01  
**Version** : 1.0.0  
**Priorit√©** : CRITIQUE ‚ö†Ô∏è
