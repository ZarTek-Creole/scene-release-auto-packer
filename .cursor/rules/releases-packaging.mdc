---
name: releases-packaging
description: R√®gles strictes pour Releases et Packaging - Conformit√© Scene
globs:
  - "**/*.{py,js,jsx,ts,tsx}"
---

# Releases & Packaging - R√®gles Strictes

## üéØ Objectif

Assurer conformit√© absolue des Releases packag√©es avec standards Scene et r√®gles scenerules.org.

---

## üìã R√®gles Obligatoires

### 1. Validation contre R√®gle

**‚ö†Ô∏è OBLIGATOIRE** : Packaging doit respecter STRICTEMENT la r√®gle Scene s√©lectionn√©e.

**Processus** :
1. Charger r√®gle compl√®te (√âtape 3)
2. Parser r√®gle (formats, template, contraintes)
3. Valider √† chaque √©tape contre r√®gle
4. Valider final avant packaging
5. Appliquer r√®gle strictement lors packaging

**Services** :
- `RuleParserService` : Parse r√®gle compl√®te
- `RuleValidationService` : Valide contre r√®gle
- `PackagingService` : Applique r√®gle lors packaging

### 2. Structure Release

**Conformit√© r√®gle** :
- ‚úÖ Fichiers requis pr√©sents selon r√®gle
- ‚úÖ Structure arborescence conforme
- ‚úÖ Nommage strict selon contraintes r√®gle
- ‚úÖ NFO conforme template r√®gle

**Exemple structure EBOOK** :
```
ReleaseName-GROUP/
‚îú‚îÄ‚îÄ ReleaseName-GROUP.epub
‚îú‚îÄ‚îÄ ReleaseName-GROUP.nfo
‚îú‚îÄ‚îÄ ReleaseName-GROUP.sfv (optionnel)
‚îî‚îÄ‚îÄ ReleaseName-GROUP.diz (optionnel)
```

### 3. Nommage Release

**Format strict** :
- Conforme contraintes r√®gle (regex)
- Pattern : `{Title}-{Group}`
- Caract√®res conformes r√®gle
- Longueur selon contraintes

**Validation** :
- ‚úÖ Format conforme regex r√®gle
- ‚úÖ Groupe conforme format Scene
- ‚úÖ Titre conforme contraintes

### 4. NFO G√©n√©r√©

**Source template** :
- ‚≠ê Template de r√®gle eBOOK [2022] (priorit√©)
- Templates locaux (fallback)

**G√©n√©ration** :
- ‚úÖ Placeholders remplis avec m√©tadonn√©es
- ‚úÖ Conditionnelles `{% if %}` ex√©cut√©es
- ‚úÖ Fonctions `{{format_date()}}` appliqu√©es
- ‚úÖ Format ASCII ‚â§ 80 colonnes
- ‚úÖ Structure conforme r√®gle

### 5. Formats Accept√©s

**EBOOK (priorit√©)** :
- EPUB, PDF, MOBI, AZW, AZW3, CBZ
- Formats exacts selon r√®gle eBOOK [2022]

**Autres types** (apr√®s EBOOK) :
- TV : MKV, MP4, AVI, etc.
- DOCS : DOCX, PDF, TXT, etc.
- AUDIOBOOK : MP3, FLAC, etc.
- GAME : ISO, etc.

**Validation** :
- ‚úÖ Format fichier conforme r√®gle
- ‚úÖ Extension valide
- ‚úÖ Taille conforme (si sp√©cifi√© r√®gle)

---

## üîç Validation Stricte

### Avant Packaging

**Checklist** :
- [ ] R√®gle charg√©e et pars√©e compl√®tement
- [ ] Format fichier conforme r√®gle
- [ ] Nommage conforme regex r√®gle
- [ ] Template NFO conforme r√®gle
- [ ] Structure conforme sp√©cifications r√®gle
- [ ] Toutes contraintes v√©rifi√©es

### Pendant Packaging

**Validations** :
- ‚úÖ Structure release conforme
- ‚úÖ Nommage fichiers conforme
- ‚úÖ NFO g√©n√©r√© conforme template r√®gle
- ‚úÖ Tous fichiers requis pr√©sents

### Apr√®s Packaging

**Validation finale** :
- ‚úÖ Release conforme r√®gle compl√®te
- ‚úÖ Tous fichiers pr√©sents
- ‚úÖ NFO valide
- ‚úÖ Structure correcte

---

## üö® Points Critiques

### Conformit√© Absolue

**‚ùå JAMAIS** :
- Packager sans r√®gle charg√©e
- Ignorer contraintes r√®gle
- Cr√©er release non conforme
- Utiliser format non accept√©

**‚úÖ TOUJOURS** :
- Valider contre r√®gle compl√®te
- Appliquer r√®gle strictement
- Respecter toutes contraintes
- G√©n√©rer NFO selon template r√®gle

### EBOOK Priorit√©

**Focus** : EBOOK en priorit√© avec conformit√© r√®gle [2022] eBOOK.

**Autres types** : TV, DOCS, etc. apr√®s confirmation EBOOK.

---

## üìö R√©f√©rences

- **Scenerules Integration** : `docs/SCENERULES_INTEGRATION.md` ‚≠ê
- **PRD-002** : `docs/PRDs/PRD-002-Nouvelle-Release.md` (Wizard 9 √©tapes)
- **PRD-003** : `docs/PRDs/PRD-003-Liste-Releases.md`
- **Database ERD** : `docs/DATABASE_ERD.md` (tables `releases`, `jobs`)
- **API Reference** : `docs/API_REFERENCE.md` (endpoints releases)

---

**Derni√®re mise √† jour** : 2025-11-01  
**Version** : 1.0.0  
**Priorit√©** : CRITIQUE ‚ö†Ô∏è
