---
alwaysApply: true
---
---
name: mcp-tools-usage
description: R√®gles d'utilisation des MCP Tools pour am√©liorer productivit√© et qualit√©
globs:
  - "**/*.{py,js,jsx,ts,tsx,md}"
---

# MCP Tools Usage - eBook Scene Packer v2

## üéØ Objectif

Utiliser les **MCP (Model Context Protocol) Tools** pour am√©liorer productivit√©, qualit√© et documentation.

**Documentation compl√®te** : Voir `docs/MCP_TOOLS_GUIDE.md`

---

## üìã R√®gles G√©n√©rales

### 1. Toujours Utiliser MCP Tools quand Appropri√©
- ‚úÖ **Utiliser MCP Tools** au lieu de m√©thodes manuelles
- ‚úÖ **Pr√©f√©rer MCP Tools** pour :
  - Tests E2E (Playwright Browser MCP)
  - Recherche documentation (Docs MCP, Context7 MCP)
  - Analyse codebase (Repomix MCP)
  - R√©solution probl√®mes complexes (Sequential Thinking MCP)

### 2. Conna√Ætre les MCP Tools Disponibles

**Cat√©gories** :
1. **Repomix MCP** : Analyse et packaging codebase
2. **Docs MCP Server** : Documentation biblioth√®ques
3. **Playwright Browser MCP** : Tests E2E et validation UI
4. **Context7 MCP** : Documentation structur√©e
5. **Memory MCP** : Knowledge graph et entit√©s
6. **Sequential Thinking MCP** : R√©solution probl√®mes complexes

---

## üîß Utilisation par Sc√©nario

### Sc√©nario 1 : Tests E2E

**‚ö†Ô∏è OBLIGATOIRE** : Utiliser **Playwright Browser MCP** pour tous les tests E2E au lieu de Playwright standard.

```python
# ‚úÖ Bon : Utiliser Playwright MCP pour tests E2E
def test_login_e2e():
    """Test login E2E avec Playwright MCP."""
    # 1. Naviguer vers application
    mcp_playwright_browser_navigate(url="http://localhost:5000")
    
    # 2. Capturer √©tat initial
    snapshot = mcp_playwright_browser_snapshot()
    assert "Login" in snapshot
    
    # 3. Interagir
    mcp_playwright_browser_type(
        element="username input",
        ref="input[name='username']",
        text="admin"
    )
    mcp_playwright_browser_type(
        element="password input",
        ref="input[name='password']",
        text="password"
    )
    mcp_playwright_browser_click(
        element="login button",
        ref="button[type='submit']"
    )
    
    # 4. Valider r√©sultat
    mcp_playwright_browser_wait_for(text="Dashboard")
    final_snapshot = mcp_playwright_browser_snapshot()
    assert "Dashboard" in final_snapshot

# ‚ùå √âviter : Playwright standard si MCP disponible
# from playwright.sync_api import sync_playwright
# with sync_playwright() as p:
#     browser = p.chromium.launch()
#     # ...
```

---

### Sc√©nario 2 : Recherche Documentation

**Quand** : Avant impl√©mentation, r√©solution probl√®me technique

**Tools √† utiliser** :
1. `mcp_docs-mcp-server_search_docs` - Rechercher documentation
2. `mcp_context7_get-library-docs` - Documentation structur√©e

```python
# ‚úÖ Bon : Rechercher documentation avant impl√©mentation
def implement_react_component():
    # 1. Rechercher documentation React
    results = mcp_docs-mcp-server_search_docs(
        library="react",
        query="useState hook examples",
        limit=5
    )
    
    # 2. Si besoin, documentation plus d√©taill√©e
    docs = mcp_context7_get-library-docs(
        context7CompatibleLibraryID="/facebook/react",
        topic="hooks",
        tokens=5000
    )
    
    # Utiliser r√©sultats pour impl√©menter...
```

---

### Sc√©nario 3 : Analyse Codebase

**Quand** : Refactoring majeur, audit code, d√©but projet

**Tools √† utiliser** :
1. `mcp_repomix_pack_codebase` - Packager codebase
2. `mcp_repomix_grep_repomix_output` - Rechercher patterns

```python
# ‚úÖ Bon : Packager codebase pour analyse majeure
output = mcp_repomix_pack_codebase(
    directory="/home/deffice/projects/ebook.scene.packer",
    style="markdown",
    compress=False
)

# Rechercher patterns sp√©cifiques
mcp_repomix_grep_repomix_output(
    outputId=output.id,
    pattern="def.*test_",
    contextLines=5
)
```

**‚ö†Ô∏è Important** : Ne pas packager pour petits changements. Utiliser `grep` directement.

---

### Sc√©nario 4 : R√©solution Probl√®me Complexe

**Quand** : Bug complexe, d√©cision architecture

**Tools √† utiliser** :
1. `mcp_sequential-thinking_sequentialthinking` - Pens√©e s√©quentielle
2. `mcp_repomix_grep_repomix_output` - Analyser code
3. `mcp_memory_search_nodes` - Rechercher connaissances

```python
# ‚úÖ Bon : Analyser probl√®me complexe
mcp_sequential-thinking_sequentialthinking(
    thought="Le wizard 9 √©tapes devient complexe √† maintenir...",
    thoughtNumber=1,
    totalThoughts=5,
    nextThoughtNeeded=True
)
```

---

## üéØ Int√©gration avec TDD

### Workflow TDD avec MCP Tools

1. **Red** : √âcrire test
   - Utiliser `mcp_playwright_browser_snapshot` pour valider √©tat initial
   
2. **Green** : Impl√©menter code minimal
   - Utiliser `mcp_docs-mcp-server_search_docs` pour recherche documentation
   - Utiliser `mcp_repomix_grep_repomix_output` pour trouver patterns similaires
   
3. **Refactor** : Am√©liorer code
   - Utiliser `mcp_sequential-thinking_sequentialthinking` pour analyser am√©liorations
   - Utiliser `mcp_playwright_browser_*` pour valider pas de r√©gression

4. **Validation** : Tests passent
   - Utiliser `mcp_playwright_browser_take_screenshot` pour documentation
   - Utiliser `mcp_memory_create_entities` pour documenter d√©cisions

---

## ‚úÖ Checklist Utilisation MCP Tools

### Avant Utilisation
- [ ] Objectif clair identifi√©
- [ ] Tool appropri√© s√©lectionn√©
- [ ] Pr√©-requis v√©rifi√©s (serveur d√©marr√©, etc.)

### Pendant Utilisation
- [ ] Utiliser tool de mani√®re isol√©e
- [ ] Capturer r√©sultats pour documentation
- [ ] V√©rifier r√©sultats coh√©rents

### Apr√®s Utilisation
- [ ] Analyser r√©sultats
- [ ] Int√©grer dans code/documentation
- [ ] Mettre √† jour m√©moire si pertinent

---

## üö´ Anti-Patterns

### ‚ùå Surutilisation
```python
# ‚ùå Mauvais : Packager codebase pour petit changement
mcp_repomix_pack_codebase(...)  # Trop lourd pour changement mineur

# ‚úÖ Bon : Utiliser grep directement pour petits changements
# Utiliser pack_codebase seulement pour analyses majeures
```

### ‚ùå Tests E2E Sans MCP
```python
# ‚ùå Mauvais : Playwright standard si MCP disponible
from playwright.sync_api import sync_playwright

# ‚úÖ Bon : Toujours utiliser Playwright MCP pour E2E
mcp_playwright_browser_navigate(...)
```

### ‚ùå Documentation Redondante
```python
# ‚ùå Mauvais : Indexer m√™me biblioth√®que plusieurs fois
mcp_docs-mcp-server_scrape_docs(library="react")  # D√©j√† index√©

# ‚úÖ Bon : V√©rifier d'abord avec list_libraries
libraries = mcp_docs-mcp-server_list_libraries()
if "react" not in libraries:
    mcp_docs-mcp-server_scrape_docs(...)
```

---

## üîó Liens

- **Guide MCP Tools** : `docs/MCP_TOOLS_GUIDE.md`
- **TDD Methodology** : `.cursor/rules/tdd-methodology.mdc`
- **Test Plan** : `docs/TEST_PLAN.md`

---

**Derni√®re mise √† jour** : 2025-11-01  
**Version** : 1.0.0
