---
alwaysApply: true
---
---
name: maintenance-evolutive
description: R√®gles strictes de maintenance √©volutive et nettoyage continu pour maintenir le projet toujours propre et coh√©rent
globs:
  - "**/*.{py,js,jsx,ts,tsx,md,yml,yaml,json}"
---

# üßπ Maintenance √âvolutive & Nettoyage Continu - eBook Scene Packer v2

## üéØ Mission

Maintenir le projet **toujours propre, coh√©rent et align√© avec la r√©alit√©** en appliquant une approche de nettoyage continu et de documentation √©volutive.

---

## üö® R√àGLES ABSOLUES DE MAINTENANCE

### 1. Documentation Toujours √† Jour

**‚ùå JAMAIS** :
- Laisser une documentation obsol√®te ou contradictoire
- Conserver des fichiers de documentation qui ne refl√®tent plus la r√©alit√©
- Avoir des TODOs ou commentaires "√† compl√©ter" dans la documentation finale

**‚úÖ TOUJOURS** :
- Mettre √† jour la documentation **imm√©diatement** apr√®s chaque changement
- Supprimer les fichiers/documentations obsol√®tes **d√®s qu'ils ne sont plus pertinents**
- V√©rifier la coh√©rence entre tous les fichiers de documentation

### 2. Nettoyage Continu

**Actions Obligatoires** :

#### 2.1 Apr√®s Chaque Phase/√âtape Compl√©t√©e

```bash
# Checklist de nettoyage obligatoire
- [ ] Supprimer les fichiers temporaires de la phase
- [ ] Mettre √† jour DEVBOOK.md (marquer √©tape termin√©e)
- [ ] V√©rifier et supprimer TODOs obsol√®tes dans todolist.md
- [ ] Mettre √† jour PRDs si fonctionnalit√©s modifi√©es
- [ ] V√©rifier coh√©rence entre documentation et code
- [ ] Supprimer les commentaires "TODO" ou "FIXME" devenus obsol√®tes
- [ ] Nettoyer les tests non utilis√©s ou obsol√®tes
```

#### 2.2 Audit Hebdomadaire (Automatis√© ou Manuel)

```bash
# Script de v√©rification √† ex√©cuter chaque semaine
./scripts/audit-documentation.sh

# V√©rifications :
- Fichiers .md obsol√®tes ou non r√©f√©renc√©s
- PRDs avec statut "Deprecated" non supprim√©s
- Sections "√Ä compl√©ter" dans la documentation
- Liens bris√©s entre documents
- Code mort ou comment√© inutilement
```

### 3. Coh√©rence Documentation ‚Üî Code

**R√®gle** : La documentation DOIT toujours refl√©ter l'√©tat actuel du code.

**V√©rifications Obligatoires** :

```python
# Exemple : V√©rifier que DEVBOOK.md correspond au code r√©el
# Si Phase 1.1 est marqu√©e "‚úÖ Termin√©e" dans DEVBOOK.md,
# alors le code correspondant DOIT exister et √™tre fonctionnel.

# Si un PRD d√©crit une fonctionnalit√©,
# alors le code DOIT l'impl√©menter ou √™tre en cours d'impl√©mentation.
```

---

## üìã Processus de Nettoyage par Type de Fichier

### Documentation Markdown

#### DEVBOOK.md
- ‚úÖ **Mettre √† jour** : √Ä chaque √©tape compl√©t√©e
- ‚ùå **Supprimer** : √âtapes non commenc√©es apr√®s 3 mois d'inactivit√© (si abandonn√©es)
- ‚úÖ **V√©rifier** : Coh√©rence entre phases d√©clar√©es termin√©es et code r√©el

#### PRDs (Product Requirement Documents)
- ‚úÖ **Mettre √† jour** : Version incr√©ment√©e si modification fonctionnalit√©
- ‚ùå **Supprimer** : PRDs avec statut "Deprecated" apr√®s 1 mois
- ‚úÖ **Archiver** : PRDs remplac√©s dans `docs/PRDs/archive/`

#### todolist.md
- ‚úÖ **Mettre √† jour** : Marquer t√¢ches compl√©t√©es imm√©diatement
- ‚ùå **Supprimer** : T√¢ches "‚è≥ Non commenc√©e" si d√©pendances impossibles
- ‚úÖ **Nettoyer** : Sections de phases compl√®tement termin√©es (garder seulement r√©sum√©)

#### PROJECT_ANALYSIS_QUESTIONS.md
- ‚úÖ **Mettre √† jour** : Marquer questions r√©solues avec d√©cisions finales
- ‚ùå **Supprimer** : Section question apr√®s 2 semaines si r√©ponse document√©e ailleurs
- ‚úÖ **Conserver** : Seulement le r√©capitulatif final des d√©cisions

### Code Source

#### Python
```python
# ‚ùå √Ä SUPPRIMER :
# - Code comment√© (sauf rares exceptions document√©es)
# - Imports non utilis√©s
# - Fonctions/m√©thodes non appel√©es
# - TODO/FIXME devenus obsol√®tes
# - Code mort (branches non atteignables)

# ‚úÖ TOUJOURS :
# - Code propre, lisible, document√©
# - Type hints pr√©sents
# - Docstrings √† jour
```

#### JavaScript/TypeScript
```typescript
// ‚ùå √Ä SUPPRIMER :
// - Composants non utilis√©s
// - Imports non utilis√©s
// - Fonctions/composants obsol√®tes
// - Console.log de debug laiss√©s
// - Commentaires TODO non pertinents

// ‚úÖ TOUJOURS :
// - Code propre avec TypeScript strict
// - Composants document√©s
// - Pas de code mort
```

### Tests

#### Fichiers de Test
- ‚ùå **Supprimer** : Tests obsol√®tes (tests de fonctionnalit√©s supprim√©es)
- ‚úÖ **Mettre √† jour** : Tests apr√®s refactoring
- ‚úÖ **Nettoyer** : Tests flaky ou instables

---

## üîç Scripts de V√©rification Automatis√©s

### Script 1 : Audit Documentation

```bash
#!/bin/bash
# scripts/audit-documentation.sh

echo "üîç Audit de la documentation..."

# 1. V√©rifier liens bris√©s
find docs/ -name "*.md" -exec grep -l "\[.*\](.*)" {} \; | while read file; do
    # V√©rifier chaque lien
    markdown-link-check "$file"
done

# 2. D√©tecter sections "√Ä compl√©ter"
grep -r "√Ä compl√©ter\|TODO\|FIXME" docs/ --include="*.md" && echo "‚ö†Ô∏è  Sections incompl√®tes trouv√©es"

# 3. V√©rifier PRDs obsol√®tes
find docs/PRDs/ -name "*.md" -exec grep -l "Deprecated" {} \; | while read file; do
    echo "‚ö†Ô∏è  PRD deprecated trouv√©: $file (√† supprimer apr√®s 1 mois)"
done

# 4. V√©rifier coh√©rence DEVBOOK ‚Üî Code
# Si phase marqu√©e termin√©e, code doit exister
./scripts/verify-devbook-consistency.sh
```

### Script 2 : Nettoyage Code

```bash
#!/bin/bash
# scripts/cleanup-code.sh

echo "üßπ Nettoyage du code..."

# 1. Supprimer imports non utilis√©s (Python)
ruff check --select F401 --fix web/ src/

# 2. Supprimer code mort (Python)
vulture web/ src/ --min-confidence 80

# 3. Supprimer console.log (TypeScript/JS)
find frontend/ -name "*.{ts,tsx,js,jsx}" -exec sed -i '/console\.log/d' {} \;

# 4. V√©rifier TODOs/FIXMEs
echo "üìã TODOs/FIXMEs restants:"
grep -r "TODO\|FIXME" web/ src/ frontend/ --include="*.{py,ts,tsx,js,jsx}" | grep -v "node_modules\|venv"
```

### Script 3 : V√©rification Coh√©rence

```bash
#!/bin/bash
# scripts/verify-consistency.sh

echo "‚úÖ V√©rification de coh√©rence..."

# 1. V√©rifier que DEVBOOK correspond au code
# Phase 1.1 termin√©e ‚Üí web/app.py doit exister
if grep -q "‚úÖ Termin√©e" docs/DEVBOOK.md && [ ! -f "web/app.py" ]; then
    echo "‚ùå Incoh√©rence: Phase 1.1 marqu√©e termin√©e mais web/app.py n'existe pas"
    exit 1
fi

# 2. V√©rifier que PRDs correspondent aux fonctionnalit√©s
# PRD-002 Wizard ‚Üí code wizard doit exister ou √™tre en cours
# (√† adapter selon avancement)

# 3. V√©rifier que todolist correspond √† DEVBOOK
# √âtapes termin√©es dans DEVBOOK doivent √™tre marqu√©es dans todolist
```

---

## üìÖ Calendrier de Maintenance

### Quotidien (Automatique)
- ‚úÖ V√©rification coh√©rence apr√®s chaque commit (pre-commit hook)

### Hebdomadaire (Manuel ou CI)
- ‚úÖ Audit documentation compl√®te
- ‚úÖ Nettoyage code mort
- ‚úÖ V√©rification liens bris√©s

### Mensuel
- ‚úÖ Review compl√®te de la documentation
- ‚úÖ Suppression fichiers/documentation obsol√®te
- ‚úÖ Archivage PRDs deprecated
- ‚úÖ Mise √† jour roadmap si n√©cessaire

---

## üö® Alertes et Actions Correctives

### Alerte 1 : Documentation Obsol√®te

**D√©tection** :
```bash
# Fichier modifi√© il y a > 3 mois et r√©f√©renc√© comme "actif"
find docs/ -name "*.md" -mtime +90 -exec grep -l "Statut.*En cours\|‚è≥" {} \;
```

**Action** :
1. V√©rifier si fonctionnalit√© toujours active
2. Si inactive > 3 mois : Marquer "Deprecated" ou supprimer
3. Mettre √† jour r√©f√©rences dans autres documents

### Alerte 2 : Code Mort

**D√©tection** :
```bash
# Fonctions non appel√©es (Python)
vulture web/ src/ --min-confidence 80

# Composants non utilis√©s (React)
# (√† impl√©menter avec analyse statique)
```

**Action** :
1. V√©rifier si vraiment non utilis√©
2. Si non utilis√© : Supprimer imm√©diatement
3. Mettre √† jour tests si n√©cessaire

### Alerte 3 : Liens Bris√©s

**D√©tection** :
```bash
# V√©rifier tous les liens Markdown
markdown-link-check docs/**/*.md
```

**Action** :
1. Corriger lien si fichier d√©plac√©
2. Supprimer r√©f√©rence si fichier supprim√©
3. Mettre √† jour document source

---

## ‚úÖ Checklist Avant Commit

### Documentation
- [ ] DEVBOOK.md √† jour (si √©tape compl√©t√©e)
- [ ] todolist.md √† jour (t√¢ches compl√©t√©es)
- [ ] PRDs √† jour (si fonctionnalit√© modifi√©e)
- [ ] Pas de sections "√Ä compl√©ter" ajout√©es
- [ ] Liens v√©rifi√©s (pas de liens bris√©s)

### Code
- [ ] Pas de code comment√© inutile
- [ ] Pas d'imports non utilis√©s
- [ ] Pas de console.log/print de debug
- [ ] Pas de TODOs/FIXMEs non document√©s
- [ ] Code mort supprim√©

### Tests
- [ ] Tests obsol√®tes supprim√©s
- [ ] Tests √† jour apr√®s modification

---

## üîÑ Processus de Suppression Documentaire

### √âtape 1 : Identifier Fichier Obsol√®te

```bash
# Crit√®res :
# - Fichier non r√©f√©renc√© depuis > 3 mois
# - Fonctionnalit√© abandonn√©e
# - Documentation remplac√©e
# - Phase/√©tape annul√©e
```

### √âtape 2 : V√©rifier D√©pendances

```bash
# Chercher toutes les r√©f√©rences
grep -r "nom-du-fichier" docs/ --include="*.md"

# Si r√©f√©rences existent :
# - Mettre √† jour r√©f√©rences
# - Ou archiver fichier au lieu de supprimer
```

### √âtape 3 : Supprimer ou Archiver

```bash
# Si r√©f√©rences existent encore :
mv docs/fichier-obsol√®te.md docs/archive/fichier-obsol√®te.md

# Si aucune r√©f√©rence :
rm docs/fichier-obsol√®te.md

# Mettre √† jour index/README si n√©cessaire
```

---

## üìä M√©triques de Propret√©

### Objectifs

- **0** fichier de documentation obsol√®te (> 3 mois non mis √† jour)
- **0** lien bris√© dans la documentation
- **< 5** TODOs/FIXMEs non document√©s dans le code
- **0** code mort (fonctions non appel√©es)
- **100%** coh√©rence DEVBOOK ‚Üî Code

### V√©rification

```bash
# Script de m√©triques
./scripts/metrics-cleanliness.sh

# Affiche :
# - Nombre fichiers obsol√®tes
# - Nombre liens bris√©s
# - Nombre TODOs restants
# - Taux de code mort
# - Score de coh√©rence
```

---

## üéØ R√®gles Sp√©cifiques par Type de Fichier

### Fichiers Markdown

**Format** :
- Toujours commencer par un en-t√™te avec titre
- Utiliser formatage coh√©rent (titres, listes, code)
- Liens relatifs uniquement
- Pas de sections vides ou "√Ä compl√©ter"

**Nettoyage** :
- Supprimer sections obsol√®tes compl√®tes
- Mettre √† jour dates de derni√®re modification
- V√©rifier formatage Markdown (linter)

### Fichiers Python

**Format** :
- Type hints obligatoires
- Docstrings Google style
- Pas de code comment√© (sauf rares exceptions)
- Imports organis√©s (stdlib, third-party, local)

**Nettoyage** :
- `ruff check --fix` pour imports non utilis√©s
- `vulture` pour d√©tecter code mort
- Supprimer fonctions non utilis√©es

### Fichiers TypeScript/React

**Format** :
- TypeScript strict mode
- Composants document√©s
- Pas de `any` (sauf rares exceptions)
- Imports organis√©s

**Nettoyage** :
- `eslint --fix` pour nettoyer automatiquement
- Supprimer composants non utilis√©s
- Pas de console.log en production

---

## üö´ Anti-Patterns √† √âviter

### ‚ùå Documentation Obsol√®te
```markdown
# ‚ùå Mauvais : Documentation non mise √† jour
# Phase 1 : Infrastructure Core ‚è≥ Non commenc√©e
# (Mais le code existe d√©j√†)

# ‚úÖ Bon : Documentation √† jour
# Phase 1 : Infrastructure Core ‚úÖ Termin√©e (2025-11-01)
```

### ‚ùå Code Comment√© "Au Cas O√π"
```python
# ‚ùå Mauvais : Code comment√© "au cas o√π"
# def old_function():
#     return old_logic()

# ‚úÖ Bon : Code supprim√© si non utilis√©
# (Utiliser git history si besoin)
```

### ‚ùå TODOs √âternels
```python
# ‚ùå Mauvais : TODO jamais r√©solu
# TODO: Impl√©menter cette fonctionnalit√©

# ‚úÖ Bon : TODO document√© avec issue/ticket
# TODO(#123): Impl√©menter cette fonctionnalit√©
# OU : TODO supprim√© si non pertinent
```

---

## üîó Liens Utiles

- **DEVBOOK** : `docs/DEVBOOK.md`
- **TodoList** : `docs/todolist.md`
- **PRDs** : `docs/PRDs/`
- **Scripts** : `scripts/audit-documentation.sh`, `scripts/cleanup-code.sh`

---

## üìù Checklist de Maintenance (√Ä Appliquer R√©guli√®rement)

### Apr√®s Chaque √âtape Compl√©t√©e
- [ ] Mettre √† jour DEVBOOK.md imm√©diatement
- [ ] Mettre √† jour todolist.md (marquer t√¢ches compl√©t√©es)
- [ ] V√©rifier et supprimer TODOs obsol√®tes
- [ ] Nettoyer code mort dans fichiers modifi√©s
- [ ] V√©rifier coh√©rence documentation ‚Üî code

### Hebdomadaire (Ex√©cuter Scripts)
```bash
# Audit complet
./scripts/audit-documentation.sh

# Nettoyage code
./scripts/cleanup-code.sh

# V√©rification coh√©rence
./scripts/verify-consistency.sh
```

### Mensuel
- [ ] Review compl√®te documentation
- [ ] Supprimer fichiers obsol√®tes (> 3 mois)
- [ ] Archiver PRDs deprecated
- [ ] Mettre √† jour roadmap si n√©cessaire

---

## üîÑ Processus Automatique Recommand√©

### Pre-commit Hook (√Ä Impl√©menter)

Cr√©er `.git/hooks/pre-commit` :
```bash
#!/bin/bash
# V√©rifications avant commit

# 1. V√©rifier que documentation mise √† jour si code modifi√©
if git diff --cached --name-only | grep -q "web/\|src/\|frontend/"; then
    # Code modifi√© ‚Üí v√©rifier si DEVBOOK √† jour
    ./scripts/verify-consistency.sh || exit 1
fi

# 2. Linter automatique
# (ruff, eslint selon type de fichier)
```

### CI/CD Integration (GitHub Actions)

```yaml
# .github/workflows/maintenance-check.yml
name: Maintenance Check

on:
  schedule:
    - cron: '0 9 * * 1'  # Tous les lundis 9h
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Audit Documentation
        run: ./scripts/audit-documentation.sh
      - name: Verify Consistency
        run: ./scripts/verify-consistency.sh
      - name: Cleanup Code
        run: ./scripts/cleanup-code.sh
```

---

## üéØ Objectifs de Qualit√©

### M√©triques Cibles
- **0** fichier documentation obsol√®te (> 3 mois)
- **0** lien bris√© dans documentation
- **< 5** TODOs non document√©s
- **0%** code mort (fonctions non appel√©es)
- **100%** coh√©rence DEVBOOK ‚Üî Code

### Score de Propret√©

```bash
# Calculer score (0-100)
./scripts/metrics-cleanliness.sh

# R√©sultat attendu: > 90%
```

---

## üìö Documentation de R√©f√©rence

- **R√®gle principale** : `.cursor/rules/maintenance-evolutive.mdc` (ce fichier)
- **Scripts** : `scripts/audit-documentation.sh`, `scripts/cleanup-code.sh`, `scripts/verify-consistency.sh`
- **DEVBOOK** : `docs/DEVBOOK.md`
- **Definition of Done** : `.cursor/rules/definition-of-done.mdc`

---

**Derni√®re mise √† jour** : 2025-11-01  
**Version** : 1.0.0  
**Priorit√©** : CRITIQUE ‚ö†Ô∏è

**Rappel** : Cette r√®gle est **toujours active** (`alwaysApply: true`) pour maintenir le projet propre en continu.
